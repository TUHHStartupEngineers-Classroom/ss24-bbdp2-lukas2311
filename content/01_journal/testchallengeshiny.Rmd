---
title: "Sales Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(ggplot2)
library(leaflet)
library(dplyr)
library(shinyWidgets)
library(plotly)

# Beispiel-Daten erstellen
set.seed(123)
data <- data.frame(
  date = seq.Date(from = as.Date("2015-01-01"), to = as.Date("2020-01-01"), by = "month"),
  sales = runif(61, min = 50000, max = 1500000),
  category = sample(c("Mountain", "Road", "Hybrid/City", "E-Bikes", "Gravel"), 61, replace = TRUE)
)

# Daten fÃ¼r Kartenvisualisierung
states <- data.frame(
  state = c("Berlin", "Bavaria", "Saxony", "North Rhine-Westphalia", "Hesse"),
  revenue = runif(5, min = 2000000, max = 14000000)
)

pal <- colorNumeric("Blues", domain = states$revenue)



dateRangeInput("date_range", "Date Range",
               start = "2015-01-01", end = "2020-01-01",
               min = "2015-01-01", max = "2020-01-01")

pickerInput("bike_type", "Bike Type", 
            choices = c("Mountain", "Road", "Hybrid/City", "E-Bikes", "Gravel"),
            selected = c("Mountain", "Road"), 
            options = list(`actions-box` = TRUE), 
            multiple = TRUE)

actionButton("apply", "Apply")
actionButton("reset", "Reset")


valueBox(1818, "Orders", icon = "fa-shopping-cart", color = "green")
valueBox("$44.1M", "Sales", icon = "fa-dollar-sign", color = "blue")
valueBox(0.9, "Ratio, Mountain to Road", icon = "fa-bicycle", color = "purple")


renderLeaflet({
  leaflet(states) %>%
    addTiles() %>%
    addPolygons(data = states, fillColor = ~pal(revenue), fillOpacity = 0.7, color = "#BDBDC3", weight = 1)
})


renderPlotly({
  data_filtered <- data %>%
    filter(date >= input$date_range[1] & date <= input$date_range[2],
           category %in% input$bike_type)
  
  p <- ggplot(data_filtered, aes(x = date, y = sales, color = category)) +
    geom_line() +
    geom_smooth(method = "loess") +
    labs(title = "Sales Over Time", x = "Date", y = "Sales")
  
  ggplotly(p)
})


```

## test